#!/usr/bin/env joker

(ns script
  (:require
    [lib.shell :refer [sh-v]]
    [joker.os :refer [env]]
    [joker.string :refer [join]]))

(def HOME (get (env) "HOME"))

(def out-path
  (let [name (join *command-line-args*)]
    (join "/" [HOME "bin/jokes" name])))

(println out-path)

(def contents
  (join "\n"
        [
         "#!/usr/bin/env joker"
         ""
         "(ns script"
         "  ;(:require ["
         "    ;[joker.os :refer [env sh]]"
         "    ;[joker.string :as string]"
         "    ;[lib.browser :as browser]"
         "    ;)"
         "  )"
         ""
         (join " " [";" out-path "stub generated by mkj"])
         ""
         "(println \"implement me!\")"
         ]))

(and
  (spit out-path contents)
  (sh-v "chmod" "+x" out-path)

  (println (str "** Wrote " out-path ": **"))
  (println (slurp out-path)))
